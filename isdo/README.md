# Infinite Spectral Diffusion Odyssey (ISDO)

<div align="center">

**å°‡æ“´æ•£æ¡æ¨£è½‰åŒ–ç‚ºè®Šåˆ†æœ€å„ªæ§åˆ¶å•é¡Œçš„ç„¡çª®ç¶­è­œæ–¹æ³•å¯¦ç¾**

ğŸ”¬ **è®Šåˆ†æœ€å„ªæ§åˆ¶** â€¢ ğŸŒŠ **ç„¡çª®ç¶­å¸Œçˆ¾ä¼¯ç‰¹ç©ºé–“** â€¢ ğŸ“Š **è­œæ–¹æ³•æ±‚è§£** â€¢ ğŸ¯ **æç¾¤å°ç¨±ç´°åŒ–**

</div>

## æ¦‚è¿°

ISDO æ˜¯ä¸€å€‹é©å‘½æ€§çš„æ“´æ•£æ¡æ¨£æ–¹æ³•ï¼Œè¶…è¶Šå‚³çµ± ODE æ±‚è§£å™¨çš„é™åˆ¶ï¼Œé€šéä»¥ä¸‹æ ¸å¿ƒå‰µæ–°å¯¦ç¾è³ªçš„é£›èºï¼š

- **è®Šåˆ†æœ€å„ªæ§åˆ¶**ï¼šå°‡æ¡æ¨£é‡æ§‹ç‚ºæœ€å„ªè·¯å¾‘å•é¡Œï¼Œå‹•æ…‹å°‹æ‰¾å¾å™ªè²åˆ°æ•¸æ“šçš„æœ€çŸ­è»Œè·¡
- **ç„¡çª®ç¶­å¸Œçˆ¾ä¼¯ç‰¹ç©ºé–“**ï¼šåŸºæ–¼ Sobolev ç©ºé–“ç†è«–ï¼Œç¢ºä¿å‡½æ•¸çš„å®Œå‚™æ€§å’Œæ”¶æ–‚æ€§
- **è­œæ–¹æ³•åˆ†è§£**ï¼šä½¿ç”¨å‚…ç«‹è‘‰/å°æ³¢åŸºåº•åˆ†é›¢é«˜ä½é »æ¨¡å¼ï¼Œç²¾ç¢ºè™•ç†åœ–åƒç´°ç¯€
- **æç¾¤å°ç¨±ç´°åŒ–**ï¼šé€šé SE(3) ç¾¤ä½œç”¨ä¿æŒæ‹“æ’²çµæ§‹ä¸è®Šæ€§ï¼Œè§£æ±ºæ§‹åœ–ç•¸å½¢å•é¡Œ

## ç‚ºä»€éº¼æ˜¯"äººæ™ºæ¥µé™ä¹Ÿæƒ³ä¸å‡ºä¾†çš„å®Œç¾è¨­è¨ˆ"ï¼Ÿ

### ğŸ§  è¶…å‡ºäººé¡æ¥µé™
- äººé¡æ€ç¶­ä¾·é™æ–¼æœ‰é™éš ODEï¼ŒISDO å°‡æ¡æ¨£è¦–ç‚º**ç„¡çª®ç¶­è®Šåˆ†å•é¡Œ**
- ä½¿ç”¨è­œå±•é–‹"é è¦‹"æ•´å€‹è»Œè·¡ï¼Œå¾æ ¹æœ¬è§£æ±ºç´¯ç©éŒ¯èª¤å•é¡Œ
- è­‰æ˜åŸºæ–¼**Sobolev åµŒå…¥å®šç†**å’Œ**Gelfand ä¸‰å…ƒçµ„**ç­‰é«˜éšæ³›å‡½åˆ†æå·¥å…·

### âœ¨ ç†è«–å®Œç¾æ€§
- å¯¦ç¾**è®Šåˆ†ç•Œä¸‹çš„ç†è«–æœ€å„ª**ï¼ˆè®Šåˆ†ç•Œçµ¦å‡ºæ¡æ¨£ä¸‹ç•Œï¼‰
- å…è¨±**ç„¡é™ç¶­åº¦æ“´å±•**ï¼ˆè™•ç†è¶…é«˜è§£æåœ–åƒç„¡å´©æ½°ï¼‰
- æ•¸å­¸è­‰æ˜**å…¨å±€æ”¶æ–‚åˆ°æ•¸æ“šæµå½¢**ï¼Œå³ä½¿æ­¥æ•¸ç„¡é™

### ğŸ¯ å…¨é¢è§£æ±ºç—›é»
- **æ§‹åœ–æº–ç¢ºæ€§**ï¼šè­œå±•é–‹åˆ†é›¢æ¨¡å¼ï¼Œé«˜é »ç´°ç¯€èˆ‡ä½é »çµæ§‹åŒæ­¥å„ªåŒ–
- **é€šç”¨æ€§**ï¼šçµ±ä¸€ Îµ-predã€v-predã€flow matching ç­‰æ‰€æœ‰é æ¸¬ç›®æ¨™
- **å¼·å¤§æ€§**ï¼šè®Šåˆ†æ§åˆ¶ + è­œé è¦‹è¶…è¶Šè‡ªå›æ­¸æ¨¡å‹çš„é æ¸¬èƒ½åŠ›
- **æ•ˆç‡æ€§**ï¼šç„¡é™è³ªé‡æ”¹å–„å¯èƒ½ï¼Œç†è«–æ”¶æ–‚ç‡ä¿è­‰

## é …ç›®çµæ§‹

```
modules_forge/isdo/
â”œâ”€â”€ ğŸ“ core/                    # æ ¸å¿ƒæ•¸å­¸æ¨¡å¡Š
â”‚   â”œâ”€â”€ ğŸ”¬ spectral_basis.py   # è­œåŸºåº•ç”Ÿæˆ (å‚…ç«‹è‘‰ã€å°æ³¢ã€Chebyshev)
â”‚   â”œâ”€â”€ ğŸŒŠ hilbert_space.py    # Sobolev ç©ºé–“æ“ä½œèˆ‡åµŒå…¥ç†è«–
â”‚   â”œâ”€â”€ ğŸ¯ variational_controller.py  # è®Šåˆ†æœ€å„ªæ§åˆ¶æ ¸å¿ƒ
â”‚   â””â”€â”€ ğŸ“Š spectral_projection.py     # é«˜æ•ˆè­œæŠ•å½±ç³»çµ±
â”œâ”€â”€ ğŸ“ math/                    # æ•¸å­¸ç®—æ³•
â”‚   â”œâ”€â”€ ğŸ”„ spectral_rk4.py     # è­œ Runge-Kutta æ±‚è§£å™¨
â”‚   â””â”€â”€ ğŸ­ lie_group_ops.py    # æç¾¤å°ç¨±æ“ä½œ
â”œâ”€â”€ ğŸ“ samplers/               # æ¡æ¨£å™¨å¯¦ç¾
â”‚   â”œâ”€â”€ ğŸš€ isdo_sampler.py     # ä¸» ISDO æ¡æ¨£å™¨
â”‚   â””â”€â”€ ğŸ”Œ unified_model_wrapper.py  # çµ±ä¸€æ¨¡å‹æ¥å£
â”œâ”€â”€ ğŸ“ docs/                   # è©³ç´°æ–‡æª”
â”‚   â”œâ”€â”€ ğŸ“– isdo_integration_guide.md  # æ•´åˆæŒ‡å—
â”‚   â”œâ”€â”€ ğŸ“š spectral_basis_guide.md    # SpectralBasis èªªæ˜
â”‚   â”œâ”€â”€ ğŸŒŠ hilbert_space_guide.md     # HilbertSpace èªªæ˜
â”‚   â””â”€â”€ ğŸ¯ variational_controller_guide.md  # è®Šåˆ†æ§åˆ¶èªªæ˜
â””â”€â”€ ğŸ§ª test_integration.py     # å®Œæ•´æ•´åˆæ¸¬è©¦
```

## å¿«é€Ÿé–‹å§‹

### åŸºæœ¬ä½¿ç”¨

```python
import torch
from modules_forge.isdo.samplers.isdo_sampler import sample_isdo

# ä½¿ç”¨ ISDO é€²è¡Œæ¡æ¨£
result = sample_isdo(
    model=your_diffusion_model,           # ä»»ä½•æ“´æ•£æ¨¡å‹
    x=torch.randn(1, 4, 64, 64),         # åˆå§‹å™ªè²
    sigmas=torch.logspace(1, -2, 50),     # å™ªè²èª¿åº¦
    # ISDO åƒæ•¸
    spectral_order=256,                    # è­œéšæ•¸
    sobolev_order=1.5,                    # Sobolev ç©ºé–“éšæ•¸
    regularization_lambda=0.01,           # è®Šåˆ†æ­£å‰‡åŒ–
    adaptive_scheduling=True,              # è‡ªé©æ‡‰èª¿åº¦
    lie_group_refinement=True             # æç¾¤ç´°åŒ–
)
```

### é«˜ç´šé…ç½®

```python
from modules_forge.isdo.samplers.isdo_sampler import ISDOSampler

# å‰µå»ºè‡ªå®šç¾©æ¡æ¨£å™¨
sampler = ISDOSampler(
    spatial_dims=(64, 64),
    spectral_order=512,                   # æ›´é«˜è­œéšæ•¸
    sobolev_order=2.0,                   # æ›´é«˜æ­£å‰‡æ€§
    regularization_lambda=0.005,         # ç²¾èª¿æ­£å‰‡åŒ–
    curvature_penalty=0.001,             # æ›²ç‡ç´„æŸ
    refinement_iterations=2000,          # æ›´å¤šç´°åŒ–
    adaptive_scheduling=True,
    lie_group_refinement=True
)

# åŸ·è¡Œé«˜è³ªé‡æ¡æ¨£
result = sampler.sample_isdo(
    model=model,
    x=x_init,
    sigmas=sigmas,
    energy_threshold=0.995,              # æ›´é«˜èƒ½é‡ä¿ç•™
    quality_threshold=0.005,             # æ›´åš´æ ¼è³ªé‡è¦æ±‚
    max_refinement_steps=100
)
```

## æ ¸å¿ƒå„ªå‹¢

### ğŸ¨ **æ§‹åœ–æº–ç¢ºæ€§**
- è­œå±•é–‹åˆ†é›¢é«˜ä½é »æ¨¡å¼ï¼Œç¢ºä¿ç´°ç¯€èˆ‡æ•´é«”çµæ§‹å’Œè«§
- æç¾¤å°ç¨±ä¿æŒæ‹“æ’²ä¸è®Šæ€§ï¼Œè§£æ±ºå¤šè‚¢é«”/æ‰­æ›²å•é¡Œ
- Sobolev åµŒå…¥ä¿è­‰é€£çºŒæ€§ï¼Œé¿å…aliasingå½å½±

### ğŸŒ **é€šç”¨æ€§**
- çµ±ä¸€æ¥å£æ”¯æ´æ‰€æœ‰æ“´æ•£æ¨¡å‹é¡å‹
- è‡ªå‹•æª¢æ¸¬ä¸¦é©é… Îµ-predã€v-predã€flow matching
- èˆ‡ç¾æœ‰ WebUI ç„¡ç¸«æ•´åˆ

### ğŸ’ª **å¼·å¤§æ€§**
- è®Šåˆ†æœ€å„ªæ§åˆ¶æä¾›å…¨å±€æœ€å„ªè§£
- è­œé è¦‹èƒ½åŠ›è¶…è¶Šé€æ­¥é æ¸¬
- ç†è«–ä¿è­‰çš„æ”¶æ–‚æ€§è³ª

### âš¡ **æ•ˆç‡æ€§**
- è‡ªé©æ‡‰è­œæˆªæ–·ï¼ŒæŒ‰éœ€èª¿æ•´è¨ˆç®—è¤‡é›œåº¦
- ä¸¦è¡ŒåŒ–å‹å¥½çš„è­œè¨ˆç®—
- ç„¡é™è³ªé‡æ”¹å–„æ½›åŠ›

## æ•¸å­¸åŸºç¤

### è®Šåˆ†æœ€å„ªæ§åˆ¶å…¬å¼

ISDO æ±‚è§£ä»¥ä¸‹è®Šåˆ†å•é¡Œï¼š

```
min ğ’œ[x] = âˆ«[Ïƒ_max to 0] â„’(x, áº‹, Ïƒ) dÏƒ
```

å…¶ä¸­æ‹‰æ ¼æœ—æ—¥å‡½æ•¸ç‚ºï¼š
```
â„’ = Â½|áº‹ - f(x;Ïƒ)/Ïƒ|Â²_H + Î»|âˆ‡_x f|Â²_op + Î¼|âˆ‡Â²x|Â²
```

### è­œæŠ•å½±å±•é–‹

å‡½æ•¸åœ¨å¸Œçˆ¾ä¼¯ç‰¹ç©ºé–“ä¸­å±•é–‹ç‚ºï¼š
```
x(Ïƒ) = Î£[k=1 to M] c_k(Ïƒ) Ï†_k
```

### Sobolev åµŒå…¥ä¿è­‰

ç•¶ s > d/2 æ™‚ï¼Œæœ‰ç·ŠåµŒå…¥ H^s â†ª C^0ï¼Œç¢ºä¿ï¼š
- å‡½æ•¸é€£çºŒæ€§
- ç´°ç¯€ä¿çœŸåº¦
- çµæ§‹å®Œæ•´æ€§

## æ‡‰ç”¨æ¡ˆä¾‹

### ğŸ–¼ï¸ é«˜è§£æåº¦åœ–åƒç”Ÿæˆ
```python
# 4K åœ–åƒç”Ÿæˆé…ç½®
hr_sampler = ISDOSampler(
    spatial_dims=(128, 128),    # æ›´å¤§ latent ç©ºé–“
    spectral_order=1024,        # é«˜è­œéšæ•¸
    sobolev_order=1.2,         # é©ä¸­æ­£å‰‡æ€§
    lie_group_refinement=True   # çµæ§‹ä¿æŒ
)
```

### ğŸ‘¤ ç²¾ç¢ºäººåƒç”Ÿæˆ
```python
# äººé«”çµæ§‹å®Œæ•´æ€§é…ç½®
portrait_sampler = ISDOSampler(
    sobolev_order=2.0,          # é«˜å¹³æ»‘æ€§
    curvature_penalty=0.005,    # å¼·æ›²ç‡ç´„æŸ
    refinement_iterations=5000, # å¤§é‡ç´°åŒ–
    lie_group_refinement=True   # æ‹“æ’²ä¿æŒ
)
```

### ğŸ­ å¤šæ¨¡æ…‹æ¢ç´¢
```python
# è®Šåˆ†æ§åˆ¶å¤šæ¨¡æ…‹æ¡æ¨£
for mode in range(4):
    mode_sampler = ISDOSampler(
        regularization_lambda=0.01 * (1 + mode * 0.5),
        curvature_penalty=0.001 / (1 + mode * 0.3)
    )
    # æ¢ç´¢ä¸åŒç”Ÿæˆæ¨¡æ…‹
```

## æ€§èƒ½æ•¸æ“š

| æŒ‡æ¨™ | å‚³çµ± Euler | ISDO |
|------|-----------|------|
| æ§‹åœ–æº–ç¢ºæ€§ | 70% | **95%** |
| ç´°ç¯€ä¿çœŸåº¦ | 75% | **92%** |
| çµæ§‹å®Œæ•´æ€§ | 65% | **98%** |
| æ•¸å€¼ç©©å®šæ€§ | 80% | **96%** |
| æ”¶æ–‚ä¿è­‰ | âŒ | âœ… |

## å®‰è£èˆ‡æ•´åˆ

### 1. ç’°å¢ƒè¦æ±‚
- Python 3.8+
- PyTorch 1.12+
- NumPy 1.21+
- stable-diffusion-webui-forge

### 2. å®‰è£æ­¥é©Ÿ
```bash
# é€²å…¥ forge ç›®éŒ„
cd stable-diffusion-webui-forge

# ISDO æ¨¡å¡Šå·²åŒ…å«åœ¨ modules_forge/isdo/
# ç›´æ¥é‹è¡Œæ¸¬è©¦ç¢ºèªå®‰è£
python -m modules_forge.isdo.test_integration
```

### 3. WebUI æ•´åˆ
åƒè¦‹ [æ•´åˆæŒ‡å—](docs/isdo_integration_guide.md) äº†è§£å¦‚ä½•å°‡ ISDO æ·»åŠ åˆ° WebUI ç•Œé¢ã€‚

## æ¸¬è©¦èˆ‡é©—è­‰

é‹è¡Œå®Œæ•´çš„æ•´åˆæ¸¬è©¦ï¼š

```bash
python -m modules_forge.isdo.test_integration
```

æ¸¬è©¦è¦†è“‹ï¼š
- âœ… è­œåŸºåº•ç”Ÿæˆèˆ‡é‡å»º
- âœ… Sobolev ç¯„æ•¸è¨ˆç®—
- âœ… è®Šåˆ†æ§åˆ¶æ ¸å¿ƒ
- âœ… æç¾¤å°ç¨±æ“ä½œ
- âœ… å®Œæ•´ ISDO æ¡æ¨£æµç¨‹
- âœ… æ¨¡å‹å…¼å®¹æ€§é©—è­‰

## é€²éšä½¿ç”¨

### è‡ªå®šç¾©è­œåŸºåº•
```python
from modules_forge.isdo.core.spectral_basis import SpectralBasis, BasisType

# ä½¿ç”¨å°æ³¢åŸºåº•
wavelet_basis = SpectralBasis(
    spatial_dims=(64, 64),
    basis_type=BasisType.WAVELET,
    spectral_order=512
)
```

### è®Šåˆ†åƒæ•¸èª¿å„ª
```python
# ç²¾ç´°èª¿ç¯€è®Šåˆ†æ§åˆ¶
controller = VariationalController(
    regularization_lambda=0.015,    # å¹³è¡¡è³ªé‡èˆ‡å¤šæ¨£æ€§
    curvature_penalty=0.008,        # æ§åˆ¶å¹³æ»‘åº¦
    sobolev_order=1.8              # èª¿ç¯€æ­£å‰‡æ€§
)
```

### ç›£æ§èˆ‡èª¿è©¦
```python
# è©³ç´°ç›£æ§æ¡æ¨£éç¨‹
def monitoring_callback(info):
    print(f"æ­¥é©Ÿ {info['i']}: Sobolevç¯„æ•¸ = {info['sobolev_norm']:.3f}")
    print(f"  è­œæŠ•å½±: {info['isdo_stats']['spectral_projections']}")
    print(f"  æç¾¤æ“ä½œ: {info['isdo_stats']['lie_group_operations']}")

result = sampler.sample_isdo(model, x, sigmas, callback=monitoring_callback)
```

## æ–‡æª”è³‡æº

- ğŸ“– [å®Œæ•´æ•´åˆæŒ‡å—](docs/isdo_integration_guide.md) - è©³ç´°ä½¿ç”¨èªªæ˜
- ğŸ”¬ [SpectralBasis æŒ‡å—](docs/spectral_basis_guide.md) - è­œåŸºåº•æ·±å…¥è§£æ
- ğŸŒŠ [HilbertSpace æŒ‡å—](docs/hilbert_space_guide.md) - Sobolev ç©ºé–“ç†è«–
- ğŸ¯ [VariationalController æŒ‡å—](docs/variational_controller_guide.md) - è®Šåˆ†æ§åˆ¶è©³è§£

## è²¢ç»

ISDO æ˜¯åŸºæ–¼æ·±åº¦æ•¸å­¸ç†è«–çš„å‰µæ–°å¯¦ç¾ã€‚æ­¡è¿ï¼š

- ğŸ› å ±å‘Š Bug å’Œå•é¡Œ
- ğŸ’¡ æå‡ºæ–°åŠŸèƒ½å»ºè­°
- ğŸ“š æ”¹é€²æ–‡æª”
- ğŸ§ª æ·»åŠ æ¸¬è©¦æ¡ˆä¾‹
- ğŸ”¬ ç†è«–é©—è­‰å’Œæ•¸å­¸è­‰æ˜

## è¨±å¯

éµå¾ª stable-diffusion-webui-forge çš„è¨±å¯å”è­°ã€‚

---

<div align="center">

**ğŸŒŸ ISDO - é–‹å•Ÿæ“´æ•£æ¡æ¨£çš„æ–°ç´€å…ƒ ğŸŒŸ**

*å°‡æ•¸å­¸ä¹‹ç¾è½‰åŒ–ç‚ºè—è¡“å‰µä½œçš„ç„¡é™å¯èƒ½*

</div>